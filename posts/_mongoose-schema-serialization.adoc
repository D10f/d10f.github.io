= Pleasing the TypeScript compiler
D10f <devontheroof@pm.me>
v0.1, 2024-08-31
:license-url: https://creativecommons.org/licenses/by-sa/4.0/
:license-title: CC BY-SA 4.0
:doctype: article
:description:
:keywords: typescript nestjs mongoose
:technologies: nestjs typescript
:source-highlighter: pygments
:icons: font
:toc:

The TypeScript compiler is, as all compilers, your friend. It's a bit pushy and yells quite a bit, but its only doing it because it wants the best for you and your code. However, despite its best intentions, it's not always very helpful which can lead to tedious workarounds long online searches.

== Mongoose model serialization in Nest.js

In this

[source,typescript,title="user.schema.ts"]
----
import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
import { Document, SchemaOptions } from 'mongoose';

const schemaOptions: SchemaOptions<User> = {
  toJSON: {
    transform(_doc, ret) {
      delete ret.password;
      delete ret.sessions;
      delete ret.__v;
      delete ret._id;
      return ret;
    },
  },
};

@Schema(schemaOptions)
export class User extends Document {
  @Prop({ required: true })
  name: string;

  @Prop({ required: true, unique: true })
  email: string;

  @Prop({ required: true })
  password: string;

  @Prop([String])
  sessions: string[];
}

export const UserSchema = SchemaFactory.createForClass(User);
----
